import re
from typing import Dict, Any, Optional

from config_reader import config


def remove_emojis(text: str) -> str:
    """Remove emojis from the text.

    Args:
        text (str): Text to remove emojis from.

    Returns:
        str: Text without emojis.
    """
    lines = text.split('\n')
    cleaned_lines = [re.sub(r'\s*\[:\w+-?\w*\]\s*', ' ', line).strip() for line in lines]
    return '\n'.join(cleaned_lines)


def start_message(first_name: str) -> str:
    return f"üëã –ü—Ä–∏–≤–µ—Ç, <b>{first_name}</b>!\n\n" \
           "üî∏ –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –Ω–∞ –±–∏—Ä–∂–µ <b>Kwork</b> –∏ –æ—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –±—ã—Å—Ç—Ä–µ–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö!\n" \
           "üî∏ –≠—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç —à–∞–Ω—Å—ã –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–∫–∞–∑—á–∏–∫ –≤—ã–±–µ—Ä–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–µ–±—è!\n\n" \
           "üöÄ –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –ø–µ—Ä–µ–π–¥–∏ –≤ —Ä–∞–∑–¥–µ–ª <i>üë§ –ü—Ä–æ—Ñ–∏–ª—å</i> –∏ –≤–∫–ª—é—á–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤.\n" \
           "üîé –°–æ–≤–µ—Ç—É–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ <i>üí¨ –ü–æ–º–æ—â—å</i>."


def project_info(data: Dict[str, Any], attachment: bool) -> str:
    username = data['wantUserGetProfileUrl'].split('/')[-1]
    profile_url = f"https://kwork.ru/user/{username}"
    projects_url = f"https://kwork.ru/projects/list/{username}"
    
    cleaned_name = remove_emojis(data['name'])
    cleaned_description = remove_emojis(data['description'])
    
    text = f"<blockquote><b>{cleaned_name}</b>\n\n" \
           f"{cleaned_description.replace('\n', '\n\n')}</blockquote>\n\n" \
           f"–ñ–µ–ª–∞–µ–º—ã–π –±—é–¥–∂–µ—Ç: –¥–æ {int(float(data['priceLimit']))} ‚ÇΩ\n" \
           f"–î–æ–ø—É—Å—Ç–∏–º—ã–π: –¥–æ {int(float(data['possiblePriceLimit']))} ‚ÇΩ\n\n" \
           f"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: <a href='{profile_url}'>{username}</a>\n" \
           f"–†–∞–∑–º–µ—â–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ –±–∏—Ä–∂–µ: {data['user']['data']['wants_count']}   " \
           f"<a href='{projects_url}'>–°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ ({data['getWantsActiveCount']})</a>\n" \
           f"–ù–∞–Ω—è—Ç–æ: {data['user']['data']['wants_hired_percent']}%\n\n" \
           f"–û—Å—Ç–∞–ª–æ—Å—å: {data['timeLeft']}\n" \
           f"–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {data['kwork_count']}"
           
    if attachment:
        text += "\n\nüìé –ù–∞–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã –≤–ª–æ–∂–µ–Ω–∏—è"
        
    return text
    
    
def user_profile(first_name: str, user_id: int) -> str:
    return f"üë§ <b>{first_name}</b>\n\n" \
           f"üè∑ <b>ID:</b> <code>{user_id}</code>"

            
def auth() -> str:
    return "üì≤ –í–æ–π–¥–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Kwork, —á—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –ø–æ —Ç–≤–æ–∏–º –ª—é–±–∏–º—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º."


def error_auth(err: Optional[str] = None) -> str:
    if not err:
        return f"‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ Kwork.\n–ü–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –µ—â–µ —Ä–∞–∑."
    return f"‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ Kwork: <i>{err}</i>.\n–ü–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –µ—â–µ —Ä–∞–∑."


def successful_auth() -> str:
    return "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.\n\n–ù–µ –∑–∞–±—É–¥—å –≤–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ <i>üë§ –ü—Ä–æ—Ñ–∏–ª—å</i>."


def projects_tracking_enabled() -> str:
    return "üîî –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–∫–ª—é—á–µ–Ω–æ"


def projects_tracking_disabled() -> str:
    return "üîï –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤—ã–∫–ª—é—á–µ–Ω–æ"


def help_sections() -> str:  
    return "–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª:"


def manual() -> str:
    return "<b>1.</b> –ù–∞ —Å–∞–π—Ç–µ kwork.ru –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ë–∏—Ä–∂–∞¬ª –≤—ã–±–µ—Ä–∏ –ª—é–±–∏–º—ã–µ —Ä—É–±—Ä–∏–∫–∏, –ø–æ –Ω–∏–º –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã.\n\n" \
           "(‚ùóÔ∏è–í–∞–∂–Ω–æ: –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞ Kwork –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–æ <i>–Ø –ø—Ä–æ–¥–∞–≤–µ—Ü</i>)\n\n" \
           "<b>2.</b> –ó–∞–π–¥–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Kwork —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –≤–≤–µ–¥—è –∫–æ–º–∞–Ω–¥—É /start –∏–ª–∏ –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫–∏ <i>–ü—Ä–æ—Ñ–∏–ª—å</i> ¬ª <i>–í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤</i>.\n\n" \
           "<b>3.</b> –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–±–µ –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä—É–±—Ä–∏–∫–∞–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Ö —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –±–∏—Ä–∂–µ.\n\n" \
           "(‚ùóÔ∏è–í–∞–∂–Ω–æ: –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É <i>–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç</i> –∏–ª–∏ <i>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É—Å–ª—É–≥—É</i>, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–π—Ç–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Kwork –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)"


def support() -> str:
    return "‚ùóÔ∏è–ü–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É, –ø—Ä–æ–≤–µ—Ä—å, –Ω–µ—Ç –ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å –≤ —Ä–∞–∑–¥–µ–ª–µ <i>üìú –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</i>.\n\n" \
           f"‚òéÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç: <span class='tg-spoiler'>{config.SUPPORT_CONTACT}</span>"
           

def get_login() -> str: 
    return "–í–≤–µ–¥–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É –∏–ª–∏ –ª–æ–≥–∏–Ω:"


def get_password() -> str:
    return "–í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å:"


def canceled() -> str:
    return "–í–≤–æ–¥ –æ—Ç–º–µ–Ω—ë–Ω"
